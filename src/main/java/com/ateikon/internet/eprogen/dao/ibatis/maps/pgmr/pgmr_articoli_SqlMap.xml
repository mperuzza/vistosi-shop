<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="pgmr_articoli">
  <resultMap class="com.ateikon.internet.eprogen.domain.pgmr.Articoli" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    <result column="cdarticolo" jdbcType="VARCHAR" property="cdarticolo" />
    <result column="cdcollezione" jdbcType="INTEGER" property="cdcollezione" />
    <result column="cdlingua" jdbcType="INTEGER" property="cdlingua" />
    <result column="dsarticolo" jdbcType="VARCHAR" property="dsarticolo" />
    <result column="cdtipoprodotto" jdbcType="INTEGER" property="cdtipoprodotto" />
    <result column="dtinizio" jdbcType="TIMESTAMP" property="dtinizio" />
    <result column="dtfine" jdbcType="TIMESTAMP" property="dtfine" />
    <result column="cdsottogruppo" jdbcType="INTEGER" property="cdsottogruppo" />
    <result column="flagvisualizza" jdbcType="VARCHAR" property="flagvisualizza" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$ #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <sql id="ibatorgenerated_Base_Column_List">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    cdarticolo, cdcollezione, cdlingua, dsarticolo, cdtipoprodotto, dtinizio, dtfine, 
    cdsottogruppo, flagvisualizza
  </sql>
  <select id="ibatorgenerated_selectByExample" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.ArticoliExample" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    select 
    <include refid="pgmr_articoli.ibatorgenerated_Base_Column_List" />
    from pgmr.articoli
    <isParameterPresent>
      <include refid="pgmr_articoli.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.ArticoliKey" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    select 
    <include refid="pgmr_articoli.ibatorgenerated_Base_Column_List" />
    from pgmr.articoli
    where cdarticolo = #cdarticolo:VARCHAR#
      and cdcollezione = #cdcollezione:INTEGER#
      and cdlingua = #cdlingua:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.ArticoliKey">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    delete from pgmr.articoli
    where cdarticolo = #cdarticolo:VARCHAR#
      and cdcollezione = #cdcollezione:INTEGER#
      and cdlingua = #cdlingua:INTEGER#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.ArticoliExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    delete from pgmr.articoli
    <include refid="pgmr_articoli.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.Articoli">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    insert into pgmr.articoli (cdarticolo, cdcollezione, cdlingua, dsarticolo, 
      cdtipoprodotto, dtinizio, dtfine, cdsottogruppo, 
      flagvisualizza)
    values (#cdarticolo:VARCHAR#, #cdcollezione:INTEGER#, #cdlingua:INTEGER#, #dsarticolo:VARCHAR#, 
      #cdtipoprodotto:INTEGER#, #dtinizio:TIMESTAMP#, #dtfine:TIMESTAMP#, #cdsottogruppo:INTEGER#, 
      #flagvisualizza:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.Articoli">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    insert into pgmr.articoli
    <dynamic prepend="(">
      <isNotNull prepend="," property="cdarticolo">
        cdarticolo
      </isNotNull>
      <isNotNull prepend="," property="cdcollezione">
        cdcollezione
      </isNotNull>
      <isNotNull prepend="," property="cdlingua">
        cdlingua
      </isNotNull>
      <isNotNull prepend="," property="dsarticolo">
        dsarticolo
      </isNotNull>
      <isNotNull prepend="," property="cdtipoprodotto">
        cdtipoprodotto
      </isNotNull>
      <isNotNull prepend="," property="dtinizio">
        dtinizio
      </isNotNull>
      <isNotNull prepend="," property="dtfine">
        dtfine
      </isNotNull>
      <isNotNull prepend="," property="cdsottogruppo">
        cdsottogruppo
      </isNotNull>
      <isNotNull prepend="," property="flagvisualizza">
        flagvisualizza
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="cdarticolo">
        #cdarticolo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cdcollezione">
        #cdcollezione:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="cdlingua">
        #cdlingua:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="dsarticolo">
        #dsarticolo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cdtipoprodotto">
        #cdtipoprodotto:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="dtinizio">
        #dtinizio:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="dtfine">
        #dtfine:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="cdsottogruppo">
        #cdsottogruppo:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="flagvisualizza">
        #flagvisualizza:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.ArticoliExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    select count(*) from pgmr.articoli
    <include refid="pgmr_articoli.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    update pgmr.articoli
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.cdarticolo">
        cdarticolo = #record.cdarticolo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.cdcollezione">
        cdcollezione = #record.cdcollezione:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.cdlingua">
        cdlingua = #record.cdlingua:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.dsarticolo">
        dsarticolo = #record.dsarticolo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.cdtipoprodotto">
        cdtipoprodotto = #record.cdtipoprodotto:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.dtinizio">
        dtinizio = #record.dtinizio:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.dtfine">
        dtfine = #record.dtfine:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.cdsottogruppo">
        cdsottogruppo = #record.cdsottogruppo:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.flagvisualizza">
        flagvisualizza = #record.flagvisualizza:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="pgmr_articoli.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    update pgmr.articoli
    set cdarticolo = #record.cdarticolo:VARCHAR#,
      cdcollezione = #record.cdcollezione:INTEGER#,
      cdlingua = #record.cdlingua:INTEGER#,
      dsarticolo = #record.dsarticolo:VARCHAR#,
      cdtipoprodotto = #record.cdtipoprodotto:INTEGER#,
      dtinizio = #record.dtinizio:TIMESTAMP#,
      dtfine = #record.dtfine:TIMESTAMP#,
      cdsottogruppo = #record.cdsottogruppo:INTEGER#,
      flagvisualizza = #record.flagvisualizza:VARCHAR#
    <isParameterPresent>
      <include refid="pgmr_articoli.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.Articoli">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    update pgmr.articoli
    <dynamic prepend="set">
      <isNotNull prepend="," property="dsarticolo">
        dsarticolo = #dsarticolo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cdtipoprodotto">
        cdtipoprodotto = #cdtipoprodotto:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="dtinizio">
        dtinizio = #dtinizio:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="dtfine">
        dtfine = #dtfine:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="cdsottogruppo">
        cdsottogruppo = #cdsottogruppo:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="flagvisualizza">
        flagvisualizza = #flagvisualizza:VARCHAR#
      </isNotNull>
    </dynamic>
    where cdarticolo = #cdarticolo:VARCHAR#
      and cdcollezione = #cdcollezione:INTEGER#
      and cdlingua = #cdlingua:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.ateikon.internet.eprogen.domain.pgmr.Articoli">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS Ibator, do not modify.
      This element was generated on Wed Feb 25 18:53:50 CET 2009.
    -->
    update pgmr.articoli
    set dsarticolo = #dsarticolo:VARCHAR#,
      cdtipoprodotto = #cdtipoprodotto:INTEGER#,
      dtinizio = #dtinizio:TIMESTAMP#,
      dtfine = #dtfine:TIMESTAMP#,
      cdsottogruppo = #cdsottogruppo:INTEGER#,
      flagvisualizza = #flagvisualizza:VARCHAR#
    where cdarticolo = #cdarticolo:VARCHAR#
      and cdcollezione = #cdcollezione:INTEGER#
      and cdlingua = #cdlingua:INTEGER#
  </update>


  <resultMap class="com.ateikon.internet.eprogen.domain.pgmr.Articoli" id="thumbMap">
    <result column="cdarticolo" jdbcType="VARCHAR" property="cdarticolo" />
    <result column="dsarticolo" jdbcType="VARCHAR" property="dsarticolo" />
    <result column="cdcollezione" jdbcType="INTEGER" property="cdcollezione" />
    <result column="wsart" jdbcType="INTEGER" property="wsart" />
  </resultMap>
  <select id="getThumbList" parameterClass="map" resultMap="thumbMap">
    SELECT  articoli.cdarticolo,
            articoli.dsarticolo,
            articoli.cdcollezione,
            articoli_linea.nrposi
    <isNotEmpty prepend="," property="id_wstest">
           (SELECT count(1) FROM pgmr.wishlist_posi WHERE idtest = #id_wstest:INTEGER# AND tipo = #tipo:VARCHAR# AND tkutente = #tkutente:NUMERIC# AND cdarticolo = articoli.cdarticolo) as wsart
    </isNotEmpty>
    <isEmpty prepend="," property="id_wstest">
            0 as wsart
    </isEmpty>
       FROM pgmr.articoli left join pgmr.sottogruppo_tipologia on pgmr.articoli.cdsottogruppo = pgmr.sottogruppo_tipologia.cdsottogruppo,
            pgmr.articoli_finiture,
            pgmr.articoli_linea
    <isNotEmpty prepend="," property="filterFiniture">
        pgmr.finiture, pgmr.tipo_finitura
    </isNotEmpty>
        WHERE articoli.cdarticolo = articoli_linea.cdarticolo
         AND articoli.cdcollezione= articoli_linea.cdcollezione
         AND articoli.cdarticolo= articoli_finiture.cdarticolo
         AND articoli.cdlingua = #cdlingua:INTEGER#
         AND articoli_linea.cdcollezione  = #cdcollezione:INTEGER#
         AND articoli_linea.cdlinea = #cdlinea:INTEGER#
         AND (articoli.flagvisualizza is null OR articoli.flagvisualizza <![CDATA[ <> ]]> 'N' )
    <isNotEmpty prepend="AND" property="filterTipoprodotto">
        sottogruppo_tipologia.cdgruppo IN
          <iterate close=")" conjunction="," open="(" property="filterTipoprodotto">
            #filterTipoprodotto[]#
          </iterate>
    </isNotEmpty>
    <isNotEmpty prepend="AND" property="filterFiniture">
            articoli_finiture.cdfinitura1 = finiture.cdfinitura
        AND finiture.cdtipofinitura = tipo_finitura.cdtipofinitura
        AND tipo_finitura.cdtipofinitura IN
          <iterate close=")" conjunction="," open="(" property="filterFiniture">
            #filterFiniture[]#
          </iterate>
    </isNotEmpty>
	GROUP BY articoli.cdarticolo, articoli.dsarticolo, articoli.cdcollezione, articoli_linea.nrposi
    ORDER BY articoli_linea.nrposi
  </select>

  <resultMap class="com.ateikon.internet.eprogen.domain.pgmr.Articoli" id="searchResultMap">
    <result column="cdarticolo" jdbcType="VARCHAR" property="cdarticolo" />
    <result column="dsarticolo" jdbcType="VARCHAR" property="dsarticolo" />
    <result column="cdcollezione" jdbcType="INTEGER" property="cdcollezione" />
    <result column="dslinea" jdbcType="VARCHAR" property="dslinea" />
    <result column="dscollezione" jdbcType="VARCHAR" property="dscollezione" />
    <result column="cdlinea" jdbcType="INTEGER" property="cdlinea" />
  </resultMap>
  <select id="searchArt" parameterClass="map" resultMap="searchResultMap">
			SELECT articoli.cdarticolo,
                  articoli.dsarticolo,
                  articoli.cdcollezione,
                  articoli_linea.cdlinea,
                  collezioni.dscollezione,
                  linee.dslinea,
                  articoli_linea.nrposi
			FROM pgmr.articoli, pgmr.articoli_finiture, pgmr.articoli_linea, pgmr.collezioni, pgmr.linee
              <isNotEmpty property="cdprofilo" prepend=",">
                    pgmr.profilo_collezioni
              </isNotEmpty>
		   WHERE articoli.cdarticolo = articoli_linea.cdarticolo
           	 AND articoli.cdcollezione= articoli_linea.cdcollezione
			 AND articoli.cdarticolo= articoli_finiture.cdarticolo
			 AND articoli_linea.cdcollezione= collezioni.cdcollezione
             AND collezioni.cdlingua =  #cdlingua:INTEGER#
            <isNotEmpty property="cdprofilo" prepend="AND">
                collezioni.cdcollezione = profilo_collezioni.cdcollezione
            AND profilo_collezioni.cdprofilo = #cdprofilo:NUMERIC#
            </isNotEmpty>
			 AND articoli_linea.cdlinea = linee.cdlinea
             AND linee.cdlingua =  #cdlingua:INTEGER#
             AND (articoli.flagvisualizza is null OR articoli.flagvisualizza <![CDATA[ <> ]]> 'N' )
			 AND articoli.cdlingua = #cdlingua:INTEGER#
             <isNotEmpty prepend="AND" property="tipologie">
                articoli.cdsottogruppo IN
                  <iterate close=")" conjunction="," open="(" property="tipologie">
                    #tipologie[]#
                  </iterate>
             </isNotEmpty>
             <isNotEmpty prepend="AND" property="finiture">
                articoli_finiture.cdfinitura1 IN
                  <iterate close=")" conjunction="," open="(" property="finiture">
                    #finiture[]#
                  </iterate>
             </isNotEmpty>
             <isNotEmpty prepend="AND" property="collezioni">
                articoli_linea.cdcollezione IN
                  <iterate close=")" conjunction="," open="(" property="collezioni">
                    #collezioni[]#
                  </iterate>
             </isNotEmpty>
             <isNotEmpty prepend="AND" property="cods">
                  <iterate close=")" conjunction="OR" open="(" property="cods">
                    ( upper(articoli.cdarticolo) like upper(#cods[]#) )
                  </iterate>
             </isNotEmpty>
             <isNotEmpty prepend="AND" property="keys">
                  <iterate close=")" conjunction="OR" open="(" property="keys">
                    ( upper(articoli.dsarticolo) like upper(#keys[]#))
                  </iterate>
             </isNotEmpty>
			GROUP BY articoli.cdarticolo,
                  articoli.dsarticolo,
                  articoli.cdcollezione,
                  articoli_linea.cdlinea,
                  collezioni.dscollezione,
                  linee.dslinea,
                  articoli_linea.nrposi
			ORDER BY linee.dslinea, collezioni.dscollezione, articoli_linea.nrposi

  </select>
</sqlMap>